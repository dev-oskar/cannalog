---
import "../styles/global.css";
import BaseLayout from "./BaseLayout.astro";
import Sidebar from "../components/Sidebar.astro";
import FooterSidebar from "../components/FooterSidebar.astro";
import { useI18n } from "../i18n/utils";

const { t } = useI18n(Astro);

const {
  user,
  title = t("dashboard.title"),
  description = t("dashboard.description"),
} = Astro.props;
---

<BaseLayout title={title} description={description}>
  <Sidebar user={user} />

  <main
    class="p-4 pt-12 sm:pt-4 md:ml-64 h-auto transition-all duration-300 ease-in-out"
  >
    <slot />
    <FooterSidebar />
  </main>

  <script>
    // Initialize main content margin based on sidebar state
    document.addEventListener("DOMContentLoaded", function () {
      const main = document.querySelector("main");
      const isDesktop = window.innerWidth >= 640;
      const isCollapsed = localStorage.getItem("sidebar-collapsed") === "true";

      // Initialize main content margin for desktop
      if (main && isDesktop && isCollapsed) {
        main.classList.remove("md:ml-64");
        main.classList.add("md:ml-0");
      }

      // Listen for sidebar state changes to adjust main content
      window.addEventListener("sidebarStateChange", function (e) {
        const isCollapsed = (e as CustomEvent).detail.collapsed;
        const isDesktop = window.innerWidth >= 640;

        if (main && isDesktop) {
          if (isCollapsed) {
            main.classList.remove("md:ml-64");
            main.classList.add("md:ml-0");
          } else {
            main.classList.remove("md:ml-0");
            main.classList.add("md:ml-64");
          }
        }
      });
    });
  </script>
</BaseLayout>
