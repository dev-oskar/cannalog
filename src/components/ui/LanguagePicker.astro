---
import { languages, type Lang } from "../../i18n/ui";
import { useI18n } from "../../i18n/utils";

const {
  lang: currentLang,
  translatePath,
  getUntranslatedPath,
} = useI18n(Astro.url);

// Path without the language prefix so we can build translated URLs
const untranslatedPath = getUntranslatedPath();

const entries = Object.entries(languages);
---

<div class="w-full">
  <label for="lang-select" class="sr-only">Change language</label>
  <select
    id="lang-select"
    class="w-full bg-transparent border border-gray-200 dark:border-gray-700 rounded-md px-3 py-2 text-sm text-text-color focus:outline-none focus:ring-2 focus:ring-primary"
    onchange="(function(e){ if(e.target.value) window.location.href = e.target.value; })(event)"
    aria-label="Select language"
  >
    {
      entries.map(([code, label]) => (
        <option
          value={translatePath(untranslatedPath, code)}
          selected={code === currentLang}
        >
          {label}
        </option>
      ))
    }
  </select>
</div>
